{% extends 'imageboard/base.html' %}
{% load static %}
{% load date_format %}
{% load markup %}
{% load i18n %}


{% block page_title %}
    {{ config.SITE_NAME }} :: /{{ board.hid }}/ {{ board.name }} :: Каталог
{% endblock %}


{% block header %}
    {% include 'imageboard/parts/header.html' %}
{% endblock %}


{% block content %}
    {% include 'imageboard/parts/board_header.html' %}

    <div class="catalog">
        <div class="catalog__items">
            {% for thread in threads %}
                {% with op_post=thread.op  %}
                    <a class="catalog-item js-thread" href="{% url 'thread_page' board_hid=thread.board.hid thread_hid=thread.hid %}" data-id="{{ thread.id }}">
                        <div class="catalog-item__image-wrap">
                            {% with image=op_post.images.all|first  %}
                                {% if image %}
                                    <div
                                        class="catalog-item__image"
                                        style="background-image: url('{{MEDIA_URL}}{{image.thumb_path}}')"
                                    ></div>
                                {% else %}
                                    <div class="catalog-item__image catalog-item__image--empty">
                                        No image
                                        <br/>
                                        available
                                    </div>
                                {% endif %}
                            {% endwith %}
                        </div>

                        <div class="catalog-item__header">
                            <span class="catalog-item__hid hid js-thread-hid" data-id="{{ thread.id }}">{{ thread.hid2hex }}</span>
                            <span class="catalog-item__title">
                                {{ op_post.title }}
                            </span>
                            <span class="catalog-item__text">
                                {% markup text=op_post.text board=board thread=thread post=op_post make_refs=False %}
                            </span>
                        </div>

                        {% spaceless %}
                        <div class="catalog-item__meta">
                            <span class="catalog-item__meta-label">Создан: </span>
                            <span class="catalog-item__meta-value">{{ thread.created_at|date:config.DATE_TIME_FORMAT }}</span>

                            <span class="catalog-item__meta-separator"></span>

                            <span class="catalog-item__meta-label">Обновлен: </span>
                            <span class="catalog-item__meta-value">{{ thread.updated_at|date:config.DATE_TIME_FORMAT }}</span>

                            <span class="catalog-item__meta-separator"></span>

                            <span class="catalog-item__meta-label">Постов: </span>
                            <span class="catalog-item__meta-value">{{ thread.posts_count }}</span>
                        </div>
                        {% endspaceless %}
                    </a>
                {% endwith %}
            {% endfor %}
        </div>
    </div>
{% endblock %}


{% block footer %}
    {% include 'imageboard/parts/footer.html' %}
{% endblock %}


{% block page_style %}
    <style>{{ board.custom_style }}</style>
{% endblock %}


{% block metadata %}
    {% if cache_data %}
        <div class="cache-data">
            Page generated at {{ cache_data.generated_at|date:config.DATE_TIME_FORMAT }}.
            Board {{ cache_data.board.hid }} updated at {{ cache_data.updated_at|date:config.DATE_TIME_FORMAT }}.
        </div>
    {% endif %}
{% endblock %}
